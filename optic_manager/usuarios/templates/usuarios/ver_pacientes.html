{% extends "./layout.html" %}
{% load static %}

{% block body %}


<h1>Datos de Pacientes</h1>

<div id="filtro">
    <label for="dni">Buscar por DNI: </label>
    <input type="number" id="dni"></input>
    <button id="buscar">BUSCAR</button>
    <p id="p_msj" style="color: red"></p><br>
    <button id="ver_todos" style="display: none">VER TODOS</button>
</div>

{% if grupo == "Secretaria" %}
    <br><a href="{% url 'editar_paciente' %}">Editar información de algún paciente</a><br>
{% endif %}

<table class="table" id="tbl">
    <thead>
        <tr> 
            <th scope="col">ID</th>
            <th scope="col">Apellido</th>
            <th scope="col">Nombre</th>
            <th scope="col">DNI</th>
            <th scope="col">Fecha de nacimiento</th>
            <th scope="col">Email</th>
            <th scope="col">Teléfono</th>
        </tr>
    </thead>
    <tbody>
        {% for paciente in pacientes %}
            <tr class="row_body">
                <th scope="row" class="num">{{paciente.id}}</th>
                <td>{{paciente.apellido}}</td>
                <td>{{paciente.nombre}}</td>
                <td>{{paciente.dni}}</td>
                <td>{{paciente.fecha_nacimiento}}</td>
                <td>{{paciente.email}}</td>
                <td>{{paciente.telefono}}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script type="text/javascript">
var boton_todos = document.getElementById("ver_todos")
var table = document.getElementById("tbl");
var tr = table.getElementsByTagName("tr");
var msj = document.getElementById("p_msj")

function buscarPaciente() {
    var dni = document.getElementById("dni").value;
    var x = 0

    boton_todos.style.display = "none";

    if (dni.toString().length != 8){
        msj.innerHTML = "Por favor ingrese un número de documento válido"
    }else{
        for (i = 0; i < tr.length; i++) {
            var td = tr[i].getElementsByTagName("td")[2];
            console.log(td)
            if (td) {
                var txtValue = td.textContent || td.innerText;
                console.log(txtValue)
                if (txtValue.toUpperCase().indexOf(dni) > -1) {
                    tr[i].style.display = "";
                    x+=1;
                    console.log(x)
                }else {
                tr[i].style.display = "none";
                }
            }
        
        }
        console.log(x)
        if(x === 0){
            msj.innerHTML = "No se encontró paciente con ese número de documento";
            for (row of tr){
                row.style.display = "";
            }
        }
        else{
            boton_todos.style.display = "";

        }
    }
}


document.getElementById("buscar").addEventListener("click", function(){
    msj.innerHTML = "";
    buscarPaciente()
})

boton_todos.addEventListener("click", function(){
    for (row of tr){
        row.style.display = "";
    }
    document.getElementById("dni").value = ""
    document.getElementById("ver_todos").style.display = "none"
})

</script>


{% endblock %}